- title('Home')
- stylesheet('map')

- if user_signed_in? and @objects.try(:any?)
  - javascript "http://maps.google.com/maps?file=api&v=2&key=#{GOOGLE_MAPS_KEY}"
  - javascript 'mapiconmaker'
  - javascript 'markermanager'
  - javascript 'jquery.metadata'
  - javascript 'jquery.jmapping.min'
  - javascript 'home_streams'

#page-header
  %h2 Social Stream
  #city-menu
    - if @my_cities.present?
      = render(:partial => 'home/cities', :locals => {:city_names => @my_cities.sort, :current_city => @city})

  %ul#social-stream-nav
    = render(:partial => 'stream_header', :locals => {:streams => @streams, :current_stream => @stream})

#content.home-content.clearfix
  .half-col
    %ul#social-stream
      -# mark the first index that is visible
      - min_index = @objects.length - @min_visible
      - @objects.reverse_each.each_with_index do |object, i|
        - visible = (i >= min_index) ? 'visible' : 'hide'
        - case object.class.to_s.underscore
        - when 'checkin'
          = render(:partial => 'home/checkins', :locals => {:objects => [object], :visible => visible})
        - when 'planned_checkin'
          = render(:partial => 'home/todos', :locals => {:objects => [object], :visible => visible})
        - when 'shout'
          = render(:partial => 'home/shouts', :locals => {:objects => [object], :visible => visible})

  .half-col.right
    #popular-cities.clearfix
      = render(:partial => 'city_cloud', :locals => {:cities => @pop_cities})
      
    %h4= @city.name
    #map.home
      -# map is here

    #map-side-bar.hide
      = render(:partial => 'locations/locations_map', :locals => {:locations => @objects.collect(&:location)})

:javascript
  var stream_map        = #{user_signed_in?};
  var max_objects       = #{@max_objects || 0};
  var max_visible       = #{@max_visible || @max_objects || 0};
  var geo_checkins_path = "/users/#{@user.try(:id)}/checkins/geo:#{@city.try(:lat).to_f}..#{@city.try(:lng).to_f}/radius:#{@radius.to_i}/#{@stream}"
  var geo_todos_path    = "/users/#{@user.try(:id)}/todos/geo:#{@city.try(:lat).to_f}..#{@city.try(:lng).to_f}/radius:#{@radius.to_i}/#{@stream}"
